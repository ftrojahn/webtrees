CKEDITOR.dialog.add("colordialog",function(c){function I(){V.getById(F).removeStyle("background-color");E.getContentElement("picker","selectedColor").setValue("");O&&O.removeAttribute("aria-selected");O=null}function b(d){d=d.data.getTarget();var e;if("td"==d.getName()&&(e=d.getChild(0).getHtml())){O=d,O.setAttribute("aria-selected",!0),E.getContentElement("picker","selectedColor").setValue(e)}}function H(e){e=e.replace(/^#/,"");for(var g=0,d=[];2>=g;g++){d[g]=parseInt(e.substr(2*g,2),16)}return"#"+(165<=0.2126*d[0]+0.7152*d[1]+0.0722*d[2]?"000":"fff")}function a(e){!e.name&&(e=new CKEDITOR.event(e));var h=!/mouse/.test(e.name),d=e.data.getTarget(),g;if("td"==d.getName()&&(g=d.getChild(0).getHtml())){o(e),h?U=d:M=d,h&&(d.setStyle("border-color",H(g)),d.setStyle("border-style","dotted")),V.getById(N).setStyle("background-color",g),V.getById(L).setHtml(g)}}function o(d){if(d=!/mouse/.test(d.name)&&U){var e=d.getChild(0).getHtml();d.setStyle("border-color",e);d.setStyle("border-style","solid")}!U&&!M&&(V.getById(N).removeStyle("background-color"),V.getById(L).setHtml("&nbsp;"))}function G(g){var k=g.data,e=k.getTarget(),h=k.getKeystroke(),j="rtl"==c.lang.dir;switch(h){case 38:if(g=e.getParent().getPrevious()){g=g.getChild([e.getIndex()]),g.focus()}k.preventDefault();break;case 40:if(g=e.getParent().getNext()){(g=g.getChild([e.getIndex()]))&&1==g.type&&g.focus()}k.preventDefault();break;case 32:case 13:b(g);k.preventDefault();break;case j?37:39:if(g=e.getNext()){1==g.type&&(g.focus(),k.preventDefault(!0))}else{if(g=e.getParent().getNext()){if((g=g.getChild([0]))&&1==g.type){g.focus(),k.preventDefault(!0)}}}break;case j?39:37:if(g=e.getPrevious()){g.focus(),k.preventDefault(!0)}else{if(g=e.getParent().getPrevious()){g=g.getLast(),g.focus(),k.preventDefault(!0)}}}}var i=CKEDITOR.dom.element,V=CKEDITOR.document,T=c.lang.colordialog,E,J={type:"html",html:"&nbsp;"},O,U,M,K=function(d){return CKEDITOR.tools.getNextId()+"_"+d},N=K("hicolor"),L=K("hicolortext"),F=K("selhicolor"),Q,S=function(h,m){for(var g=h;g<h+3;g++){var j=new i(Q.$.insertRow(-1));j.setAttribute("role","row");for(var l=m;l<m+3;l++){for(var k=0;6>k;k++){f(j.$,"#"+P[l]+P[k]+P[g])}}}},f=function(g,j){var e=new i(g.insertCell(-1));e.setAttribute("class","ColorCell");e.setAttribute("tabIndex",-1);e.setAttribute("role","gridcell");e.on("keydown",G);e.on("click",b);e.on("focus",a);e.on("blur",o);e.setStyle("background-color",j);e.setStyle("border","1px solid "+j);e.setStyle("width","14px");e.setStyle("height","14px");var h=K("color_table_cell");e.setAttribute("aria-labelledby",h);e.append(CKEDITOR.dom.element.createFromHtml('<span id="'+h+'" class="cke_voice_label">'+j+"</span>",CKEDITOR.document))};Q=CKEDITOR.dom.element.createFromHtml('<table tabIndex="-1" aria-label="'+T.options+'" role="grid" style="border-collapse:separate;" cellspacing="0"><caption class="cke_voice_label">'+T.options+'</caption><tbody role="presentation"></tbody></table>');Q.on("mouseover",a);Q.on("mouseout",o);var P="00 33 66 99 cc ff".split(" ");S(0,0);S(3,0);S(0,3);S(3,3);S=new i(Q.$.insertRow(-1));S.setAttribute("role","row");for(var R=0;6>R;R++){f(S.$,"#"+P[R]+P[R]+P[R])}for(R=0;12>R;R++){f(S.$,"#000000")}return{title:T.title,minWidth:360,minHeight:220,onLoad:function(){E=this},onHide:function(){I();var d=U.getChild(0).getHtml();U.setStyle("border-color",d);U.setStyle("border-style","solid");V.getById(N).removeStyle("background-color");V.getById(L).setHtml("&nbsp;");U=null},contents:[{id:"picker",label:T.title,accessKey:"I",elements:[{type:"hbox",padding:0,widths:["70%","10%","30%"],children:[{type:"html",html:"<div></div>",onLoad:function(){CKEDITOR.document.getById(this.domId).append(Q)},focus:function(){(U||this.getElement().getElementsByTag("td").getItem(0)).focus()}},J,{type:"vbox",padding:0,widths:["70%","5%","25%"],children:[{type:"html",html:"<span>"+T.highlight+'</span>\t\t\t\t\t\t\t\t\t\t\t\t<div id="'+N+'" style="border: 1px solid; height: 74px; width: 74px;"></div>\t\t\t\t\t\t\t\t\t\t\t\t<div id="'+L+'">&nbsp;</div><span>'+T.selected+'</span>\t\t\t\t\t\t\t\t\t\t\t\t<div id="'+F+'" style="border: 1px solid; height: 20px; width: 74px;"></div>'},{type:"text",label:T.selected,labelStyle:"display:none",id:"selectedColor",style:"width: 74px",onChange:function(){try{V.getById(F).setStyle("background-color",this.getValue())}catch(d){I()}}},J,{type:"button",id:"clear",style:"margin-top: 5px",label:T.clear,onClick:I}]}]}]}]}});