(function(){function b(q){q=q.toUpperCase();for(var p=o.length,t=0,u=0;u<p;++u){for(var s=o[u],r=s[1].length;q.substr(0,r)==s[1];q=q.substr(r)){t+=s[0]}}return t}function n(q){q=q.toUpperCase();for(var p=m.length,r=1,s=1;0<q.length;s*=p){r+=m.indexOf(q.charAt(q.length-1))*s,q=q.substr(0,q.length-1)}return r}var e=CKEDITOR.htmlParser.fragment.prototype,f=CKEDITOR.htmlParser.element.prototype;e.onlyChild=f.onlyChild=function(){var p=this.children;return 1==p.length&&p[0]||null};f.removeAnyChildWithName=function(q){for(var p=this.children,s=[],t,r=0;r<p.length;r++){t=p[r],t.name&&(t.name==q&&(s.push(t),p.splice(r--,1)),s=s.concat(t.removeAnyChildWithName(q)))}return s};f.getAncestor=function(q){for(var p=this.parent;p&&(!p.name||!p.name.match(q));){p=p.parent}return p};e.firstChild=f.firstChild=function(q){for(var p,r=0;r<this.children.length;r++){if(p=this.children[r],q(p)||p.name&&(p=p.firstChild(q))){return p}}return null};f.addStyle=function(q,p,s){var t="";if("string"==typeof p){t+=q+":"+p+";"}else{if("object"==typeof q){for(var r in q){q.hasOwnProperty(r)&&(t+=r+":"+q[r]+";")}}else{t+=q}s=p}this.attributes||(this.attributes={});q=this.attributes.style||"";q=(s?[t,q]:[q,t]).join(";");this.attributes.style=q.replace(/^;|;(?=;)/,"")};CKEDITOR.dtd.parentOf=function(q){var p={},r;for(r in this){-1==r.indexOf("$")&&this[r][q]&&(p[r]=1)}return p};var g=/^([.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz){1}?/i,l=/^(?:\b0[^\s]*\s*){1,4}$/,d={ol:{decimal:/\d+/,"lower-roman":/^m{0,4}(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})$/,"upper-roman":/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/,"lower-alpha":/^[a-z]+$/,"upper-alpha":/^[A-Z]+$/},ul:{disc:/[l\u00B7\u2002]/,circle:/[\u006F\u00D8]/,square:/[\u006E\u25C6]/}},o=[[1000,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]],m="ABCDEFGHIJKLMNOPQRSTUVWXYZ",k=0,a=null,i,e=CKEDITOR.plugins,c=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;"></div>',CKEDITOR.document);CKEDITOR.document.getBody().append(c);var j=e.pastefromword={utils:{createListBulletMarker:function(q,p){var r=new CKEDITOR.htmlParser.element("cke:listbullet");r.attributes={"cke:listsymbol":q[0]};r.add(new CKEDITOR.htmlParser.text(p));return r},isListBulletIndicator:function(p){if(/mso-list\s*:\s*Ignore/i.test(p.attributes&&p.attributes.style)){return !0}},isContainingOnlySpaces:function(q){var p;return(p=q.onlyChild())&&/^(:?\s|&nbsp;)+$/.test(p.value)},resolveList:function(q){var p=q.attributes,r;if((r=q.removeAnyChildWithName("cke:listbullet"))&&r.length&&(r=r[0])){return q.name="cke:li",p.style&&(p.style=j.filters.stylesFilter([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(s){s=s.split(" ");s=CKEDITOR.tools.convertToPx(s[3]||s[1]||s[0]);!k&&(null!==a&&s>a)&&(k=s-a);a=s;p["cke:indent"]=k&&Math.ceil(s/k)+1||1}],[/^mso-list$/,null,function(s){s=s.split(" ");var t=Number(s[0].match(/\d+/));s=Number(s[1].match(/\d+/));1==s&&(t!==i&&(p["cke:reset"]=1),i=t);p["cke:indent"]=s}]])(p.style,q)||""),p["cke:indent"]||(a=0,p["cke:indent"]=1),CKEDITOR.tools.extend(p,r.attributes),!0}i=a=k=null;return !1},getStyleComponents:function(q,p,r){c.setStyle(q,p);q={};p=r.length;for(var s=0;s<p;s++){q[r[s]]=c.getStyle(r[s])}return q},listDtdParents:CKEDITOR.dtd.parentOf("ol")},filters:{flattenList:function(z,y){y="number"==typeof y?y:1;var w=z.attributes,x;switch(w.type){case"a":x="lower-alpha";break;case"1":x="decimal"}for(var v=z.children,u,s=0;s<v.length;s++){if(u=v[s],u.name in CKEDITOR.dtd.$listItem){var t=u.attributes,r=u.children,q=r[r.length-1];q.name in CKEDITOR.dtd.$list&&(z.add(q,s+1),--r.length||v.splice(s--,1));u.name="cke:li";w.start&&!s&&(t.value=w.start);j.filters.stylesFilter([["tab-stops",null,function(p){(p=p.split(" ")[1].match(g))&&(a=CKEDITOR.tools.convertToPx(p[0]))}],1==y?["mso-list",null,function(p){p=p.split(" ");p=Number(p[0].match(/\d+/));p!==i&&(t["cke:reset"]=1);i=p}]:null])(t.style);t["cke:indent"]=y;t["cke:listtype"]=z.name;t["cke:list-style-type"]=x}else{if(u.name in CKEDITOR.dtd.$list){arguments.callee.apply(this,[u,y+1]);v=v.slice(0,s).concat(u.children).concat(v.slice(s+1));z.children=[];u=0;for(r=v.length;u<r;u++){z.add(v[u])}}}}delete z.name;w["cke:list"]=1},assembleList:function(M){var L=M.children,J,K,I,H,F,G;M=[];for(var E,A,D,B,C,x,y=0;y<L.length;y++){if(J=L[y],"cke:li"==J.name){if(J.name="li",K=J.attributes,D=(D=K["cke:listsymbol"])&&D.match(/^(?:[(]?)([^\s]+?)([.)]?)$/),B=C=x=null,K["cke:ignored"]){L.splice(y--,1)}else{K["cke:reset"]&&(G=H=F=null);I=Number(K["cke:indent"]);I!=H&&(A=E=null);if(D){if(A&&d[A][E].test(D[1])){B=A,C=E}else{for(var w in d){for(var r in d[w]){if(d[w][r].test(D[1])){if("ol"==w&&/alpha|roman/.test(r)){if(E=/roman/.test(r)?b(D[1]):n(D[1]),!x||E<x){x=E,B=w,C=r}}else{B=w;C=r;break}}}}}!B&&(B=D[2]?"ol":"ul")}else{B=K["cke:listtype"]||"ol",C=K["cke:list-style-type"]}A=B;E=C||("ol"==B?"decimal":"disc");C&&C!=("ol"==B?"decimal":"disc")&&J.addStyle("list-style-type",C);if("ol"==B&&D){switch(C){case"decimal":x=Number(D[1]);break;case"lower-roman":case"upper-roman":x=b(D[1]);break;case"lower-alpha":case"upper-alpha":x=n(D[1])}J.attributes.value=x}if(G){if(I>H){M.push(G=new CKEDITOR.htmlParser.element(B)),G.add(J),F.add(G)}else{if(I<H){H-=I;for(var z;H--&&(z=G.parent);){G=z.parent}}G.add(J)}L.splice(y--,1)}else{M.push(G=new CKEDITOR.htmlParser.element(B)),G.add(J),L[y]=G}F=J;H=I}}else{G&&(G=H=F=null)}}for(y=0;y<M.length;y++){if(G=M[y],w=G.children,E=E=void 0,r=G.children.length,z=E=void 0,L=/list-style-type:(.*?)(?:;|$)/,H=CKEDITOR.plugins.pastefromword.filters.stylesFilter,E=G.attributes,!L.exec(E.style)){for(F=0;F<r;F++){if(E=w[F],E.attributes.value&&Number(E.attributes.value)==F+1&&delete E.attributes.value,E=L.exec(E.attributes.style)){if(E[1]==z||!z){z=E[1]}else{z=null;break}}}if(z){for(F=0;F<r;F++){E=w[F].attributes,E.style&&(E.style=H([["list-style-type"]])(E.style)||"")}G.addStyle("list-style-type",z)}}}i=a=k=null},falsyFilter:function(){return !1},stylesFilter:function(q,p){return function(t,u){var s=[];(t||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(A,x,y){x=x.toLowerCase();"font-family"==x&&(y=y.replace(/["']/g,""));for(var z,w,B,v=0;v<q.length;v++){if(q[v]&&(A=q[v][0],z=q[v][1],w=q[v][2],B=q[v][3],x.match(A)&&(!z||y.match(z)))){x=B||x;p&&(w=w||y);"function"==typeof w&&(w=w(y,u,x));w&&w.push&&(x=w[0],w=w[1]);"string"==typeof w&&s.push([x,w]);return}}!p&&s.push([x,y])});for(var r=0;r<s.length;r++){s[r]=s[r].join(":")}return s.length?s.join(";")+";":!1}},elementMigrateFilter:function(q,p){return function(r){var s=p?(new CKEDITOR.style(q,p))._.definition:q;r.name=s.element;CKEDITOR.tools.extend(r.attributes,CKEDITOR.tools.clone(s.attributes));r.addStyle(CKEDITOR.style.getStyleText(s))}},styleMigrateFilter:function(q,p){var r=this.elementMigrateFilter;return function(v,u){var t=new CKEDITOR.htmlParser.element(null),s={};s[p]=v;r(q,s)(t);t.children=u.children;u.children=[t]}},bogusAttrFilter:function(q,p){if(-1==p.name.indexOf("cke:")){return !1}},applyStyleFilter:null},getRules:function(O){var N=CKEDITOR.dtd,L=CKEDITOR.tools.extend({},N.$block,N.$listItem,N.$tableContent),M=O.config,K=this.filters;O=K.falsyFilter;var J=K.stylesFilter,H=K.elementMigrateFilter,I=CKEDITOR.tools.bind(this.filters.styleMigrateFilter,this.filters),G=this.utils.createListBulletMarker,C=K.flattenList,F=K.assembleList,D=this.utils.isListBulletIndicator,E=this.utils.isContainingOnlySpaces,y=this.utils.resolveList,z=function(p){p=CKEDITOR.tools.convertToPx(p);return isNaN(p)?p:p+"px"},x=this.utils.getStyleComponents,w=this.utils.listDtdParents,B=!1!==M.pasteFromWordRemoveFontStyles,A=!1!==M.pasteFromWordRemoveStyles;return{elementNames:[[/meta|link|script/,""]],root:function(p){p.filterChildren();F(p)},elements:{"^":function(q){var p;CKEDITOR.env.gecko&&(p=K.applyStyleFilter)&&p(q)},$:function(q){var p=q.name||"",r=q.attributes;p in L&&r.style&&(r.style=J([[/^(:?width|height)$/,null,z]])(r.style)||"");if(p.match(/h\d/)){q.filterChildren();if(y(q)){return}H(M["format_"+p])(q)}else{if(p in N.$inline){q.filterChildren(),E(q)&&delete q.name}else{if(-1!=p.indexOf(":")&&-1==p.indexOf("cke")){q.filterChildren();if("v:imagedata"==p){if(p=q.attributes["o:href"]){q.attributes.src=p}q.name="img";return}delete q.name}}}p in w&&(q.filterChildren(),F(q))},style:function(q){if(CKEDITOR.env.gecko){q=(q=q.onlyChild().value.match(/\/\* Style Definitions \*\/([\s\S]*?)\/\*/))&&q[1];var p={};q&&(q.replace(/[\n\r]/g,"").replace(/(.+?)\{(.+?)\}/g,function(s,r,t){r=r.split(",");s=r.length;for(var u=0;u<s;u++){CKEDITOR.tools.trim(r[u]).replace(/^(\w+)(\.[\w-]+)?$/g,function(P,v,Q){v=v||"*";Q=Q.substring(1,Q.length);Q.match(/MsoNormal/)||(p[v]||(p[v]={}),Q?p[v][Q]=t:p[v]=t)})}}),K.applyStyleFilter=function(s){var r=p["*"]?"*":s.name,t=s.attributes&&s.attributes["class"];r in p&&(r=p[r],"object"==typeof r&&(r=r[t]),r&&s.addStyle(r,!0))})}return !1},p:function(q){if(/MsoListParagraph/.exec(q.attributes["class"])){var p=q.firstChild(function(r){return r.type==CKEDITOR.NODE_TEXT&&!E(r.parent)});(p=(p=p&&p.parent)&&p.attributes)&&!p.style&&(p.style="mso-list: Ignore;")}q.filterChildren();y(q)||(M.enterMode==CKEDITOR.ENTER_BR?(delete q.name,q.add(new CKEDITOR.htmlParser.element("br"))):H(M["format_"+(M.enterMode==CKEDITOR.ENTER_P?"p":"div")])(q))},div:function(q){var p=q.onlyChild();if(p&&"table"==p.name){var r=q.attributes;p.attributes=CKEDITOR.tools.extend(p.attributes,r);r.style&&p.addStyle(r.style);p=new CKEDITOR.htmlParser.element("div");p.addStyle("clear","both");q.add(p);delete q.name}},td:function(p){p.getAncestor("thead")&&(p.name="th")},ol:C,ul:C,dl:C,font:function(q){if(D(q.parent)){delete q.name}else{q.filterChildren();var p=q.attributes,s=p.style,r=q.parent;"font"==r.name?(CKEDITOR.tools.extend(r.attributes,q.attributes),s&&r.addStyle(s),delete q.name):(s=s||"",p.color&&("#000000"!=p.color&&(s+="color:"+p.color+";"),delete p.color),p.face&&(s+="font-family:"+p.face+";",delete p.face),p.size&&(s+="font-size:"+(3<p.size?"large":3>p.size?"small":"medium")+";",delete p.size),q.name="span",q.addStyle(s))}},span:function(q){if(D(q.parent)){return !1}q.filterChildren();if(E(q)){return delete q.name,null}if(D(q)){var p=q.firstChild(function(s){return s.value||"img"==s.name}),r=(p=p&&(p.value||"l."))&&p.match(/^(?:[(]?)([^\s]+?)([.)]?)$/);if(r){return p=G(r,p),(q=q.getAncestor("span"))&&/ mso-hide:\s*all|display:\s*none /.test(q.attributes.style)&&(p.attributes["cke:ignored"]=1),p}}if(r=(p=q.attributes)&&p.style){p.style=J([["line-height"],[/^font-family$/,null,!B?I(M.font_style,"family"):null],[/^font-size$/,null,!B?I(M.fontSize_style,"size"):null],[/^color$/,null,!B?I(M.colorButton_foreStyle,"color"):null],[/^background-color$/,null,!B?I(M.colorButton_backStyle,"color"):null]])(r,q)||""}return null},b:H(M.coreStyles_bold),i:H(M.coreStyles_italic),u:H(M.coreStyles_underline),s:H(M.coreStyles_strike),sup:H(M.coreStyles_superscript),sub:H(M.coreStyles_subscript),a:function(q){var p=q.attributes;p&&!p.href&&p.name?delete q.name:CKEDITOR.env.webkit&&(p.href&&p.href.match(/file:\/\/\/[\S]+#/i))&&(p.href=p.href.replace(/file:\/\/\/[^#]+/i,""))},"cke:listbullet":function(p){p.getAncestor(/h\d/)&&!M.pasteFromWordNumberedHeadingToList&&delete p.name}},attributeNames:[[/^onmouse(:?out|over)/,""],[/^onload$/,""],[/(?:v|o):\w+/,""],[/^lang/,""]],attributes:{style:J(A?[[/^list-style-type$/,null],[/^margin$|^margin-(?!bottom|top)/,null,function(q,p,r){if(p.name in {p:1,div:1}){p="ltr"==M.contentsLangDirection?"margin-left":"margin-right";if("margin"==r){q=x(r,q,[p])[p]}else{if(r!=p){return null}}if(q&&!l.test(q)){return[p,q]}}return null}],[/^clear$/],[/^border.*|margin.*|vertical-align|float$/,null,function(q,p){if("img"==p.name){return q}}],[/^width|height$/,null,function(q,p){if(p.name in {table:1,td:1,th:1,img:1}){return q}}]]:[[/^mso-/],[/-color$/,null,function(p){if("transparent"==p){return !1}if(CKEDITOR.env.gecko){return p.replace(/-moz-use-text-color/g,"transparent")}}],[/^margin$/,l],["text-indent","0cm"],["page-break-before"],["tab-stops"],["display","none"],B?[/font-?/]:null],A),width:function(p,q){if(q.name in N.$tableContent){return !1}},border:function(p,q){if(q.name in N.$tableContent){return !1}},"class":O,bgcolor:O,valign:A?O:function(q,p){p.addStyle("vertical-align",q);return !1}},comment:!CKEDITOR.env.ie?function(q,p){var s=q.match(/<img.*?>/),r=q.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);return r?(r=(s=r[1]||s&&"l.")&&s.match(/>(?:[(]?)([^\s]+?)([.)]?)</),G(r,s)):CKEDITOR.env.gecko&&s?(s=CKEDITOR.htmlParser.fragment.fromHtml(s[0]).children[0],(r=(r=(r=p.previous)&&r.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&r[1])&&(s.attributes.src=r),s):!1}:O}}},h=function(){this.dataFilter=new CKEDITOR.htmlParser.filter};h.prototype={toHtml:function(q){q=CKEDITOR.htmlParser.fragment.fromHtml(q,!1);var p=new CKEDITOR.htmlParser.basicWriter;q.writeHtml(p,this.dataFilter);return p.getHtml(!0)}};CKEDITOR.cleanWord=function(q,p){CKEDITOR.env.gecko&&(q=q.replace(/(\x3c!--\[if[^<]*?\])--\x3e([\S\s]*?)\x3c!--(\[endif\]--\x3e)/gi,"$1$2$3"));var s=new h,t=s.dataFilter;t.addRules(CKEDITOR.plugins.pastefromword.getRules(p));p.fire("beforeCleanWord",{filter:t});try{q=s.toHtml(q,!1)}catch(r){alert(p.lang.pastefromword.error)}q=q.replace(/cke:.*?".*?"/g,"");q=q.replace(/style=""/g,"");return q=q.replace(/<span>/g,"")}})();