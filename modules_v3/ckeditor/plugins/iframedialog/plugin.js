CKEDITOR.plugins.add("iframedialog",{requires:["dialog"],onLoad:function(){CKEDITOR.dialog.addIframe=function(o,q,r,n,c,m,l){r={type:"iframe",src:r,width:"100%",height:"100%"};r.onContentLoad="function"==typeof m?m:function(){var d=this.getElement().$.contentWindow;if(d.onDialogEvent){var f=this.getDialog(),e=function(b){return d.onDialogEvent(b)};f.on("ok",e);f.on("cancel",e);f.on("resize",e);f.on("hide",function(g){f.removeListener("ok",e);f.removeListener("cancel",e);f.removeListener("resize",e);g.removeListener()});d.onDialogEvent({name:"load",sender:this,editor:f._.editor})}};var i={title:q,minWidth:n,minHeight:c,contents:[{id:"iframe",label:q,expand:!0,elements:[r]}]},p;for(p in l){i[p]=l[p]}this.add(o,function(){return i})};var a=function(o,q,r){if(!(3>arguments.length)){var n=this._||(this._={}),c=q.onContentLoad&&CKEDITOR.tools.bind(q.onContentLoad,this),m=CKEDITOR.tools.cssLength(q.width),l=CKEDITOR.tools.cssLength(q.height);n.frameId=CKEDITOR.tools.getNextId()+"_iframe";o.on("load",function(){CKEDITOR.document.getById(n.frameId).getParent().setStyles({width:m,height:l})});var i={src:"%2",id:n.frameId,frameborder:0,allowtransparency:!0},p=[];"function"==typeof q.onContentLoad&&(i.onload="CKEDITOR.tools.callFunction(%1);");CKEDITOR.ui.dialog.uiElement.call(this,o,q,p,"iframe",{width:m,height:l},i,"");r.push('<div style="width:'+m+";height:"+l+';" id="'+this.domId+'"></div>');p=p.join("");o.on("show",function(){var b=CKEDITOR.document.getById(n.frameId).getParent(),d=CKEDITOR.tools.addFunction(c),d=p.replace("%1",d).replace("%2",CKEDITOR.tools.htmlEncode(q.src));b.setHtml(d)})}};a.prototype=new CKEDITOR.ui.dialog.uiElement;CKEDITOR.dialog.addUIElement("iframe",{build:function(f,c,d){return new a(f,c,d)}})}});