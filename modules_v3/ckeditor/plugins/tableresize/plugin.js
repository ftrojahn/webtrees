(function(){function c(i){return CKEDITOR.env.ie?i.$.clientWidth:parseInt(i.getComputedStyle("width"),10)}function g(j,k){var i=j.getComputedStyle("border-"+k+"-width"),l={thin:"0px",medium:"1px",thick:"2px"};0>i.indexOf("px")&&(i=i in l&&"none"!=j.getComputedStyle("border-style")?l[i]:0);return parseInt(i,10)}function a(B){var u=[],A=-1,y="rtl"==B.getComputedStyle("direction"),x;x=B.$.rows;for(var v=0,w,z,p,s=0,q=x.length;s<q;s++){p=x[s],w=p.cells.length,w>v&&(v=w,z=p)}x=z;v=new CKEDITOR.dom.element(B.$.tBodies[0]);w=v.getDocumentPosition();z=0;for(p=x.cells.length;z<p;z++){var s=new CKEDITOR.dom.element(x.cells[z]),q=x.cells[z+1]&&new CKEDITOR.dom.element(x.cells[z+1]),A=A+(s.$.colSpan||1),i,t,o=s.getDocumentPosition().x;y?t=o+g(s,"left"):i=o+s.$.offsetWidth-g(s,"right");q?(o=q.getDocumentPosition().x,y?i=o+q.$.offsetWidth-g(q,"right"):t=o+g(q,"left")):(o=B.getDocumentPosition().x,y?i=o:t=o+B.$.offsetWidth);s=Math.max(t-i,3);u.push({table:B,index:A,x:i,y:w.y,width:s,height:v.$.offsetHeight,rtl:y})}return u}function b(i){(i.data||i).preventDefault()}function h(E){function t(){for(var k=v.rtl,l=k?C.length:i.length,u=0;u<l;u++){var r=i[u],n=C[u],m=v.table;CKEDITOR.tools.setTimeout(function(J,y,I,H,G,A){J&&J.setStyle("width",d(Math.max(y+A,0)));I&&I.setStyle("width",d(Math.max(H-A,0)));G&&m.setStyle("width",d(G+A*(k?-1:1)))},0,this,[r,r&&c(r),n,n&&c(n),(!r||!n)&&c(m)+g(m,"left")+g(m,"right"),q])}}function D(y){b(y);y=v.index;for(var G=CKEDITOR.tools.buildTableMap(v.table),n=[],m=[],l=Number.MAX_VALUE,I=l,H=v.rtl,r=0,A=G.length;r<A;r++){var k=G[r],J=k[y+(H?1:0)],k=k[y+(H?0:1)],J=J&&new CKEDITOR.dom.element(J),k=k&&new CKEDITOR.dom.element(k);if(!J||!k||!J.equals(k)){J&&(l=Math.min(l,c(J))),k&&(I=Math.min(I,c(k))),n.push(J),m.push(k)}}i=n;C=m;o=v.x-l;j=v.x+I;B.setOpacity(0.5);s=parseInt(B.getStyle("left"),10);q=0;p=1;B.on("mousemove",x);w.on("dragstart",b);w.on("mouseup",z,this)}function z(k){k.removeListener();p=0;B.setOpacity(0);q&&t();var l=v.table;setTimeout(function(){l.removeCustomData("_cke_table_pillars")},0);w.removeListener("dragstart",b)}function x(k){F(k.data.$.clientX)}var v,w,B,p,s,q,i,C,o,j;w=E.document;B=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"></div>',w);f||w.getDocumentElement().append(B);this.attachTo=function(k){p||(f&&(w.getBody().append(B),q=0),v=k,B.setStyles({width:d(k.width),height:d(k.height),left:d(k.x),top:d(k.y)}),f&&B.setOpacity(0.25),B.on("mousedown",D,this),w.getBody().setStyle("cursor","col-resize"),B.show())};var F=this.move=function(k){if(!v){return 0}if(!p&&(k<v.x||k>v.x+v.width)){return v=null,p=q=0,w.removeListener("mouseup",z),B.removeListener("mousedown",D),B.removeListener("mousemove",x),w.getBody().setStyle("cursor","auto"),f?B.remove():B.hide(),0}k-=Math.round(B.$.offsetWidth/2);if(p){if(k==o||k==j){return 1}k=Math.max(k,o);k=Math.min(k,j);q=k-s}B.setStyle("left",d(k));return 1}}function e(j){var k=j.data.getTarget();if("mouseout"==j.name){if(!k.is("table")){return}for(var i=new CKEDITOR.dom.element(j.data.$.relatedTarget||j.data.$.toElement);i&&i.$&&!i.equals(k)&&!i.is("body");){i=i.getParent()}if(!i||i.equals(k)){return}}k.getAscendant("table",1).removeCustomData("_cke_table_pillars");j.removeListener()}var d=CKEDITOR.tools.cssLength,f=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks||7>CKEDITOR.env.version);CKEDITOR.plugins.add("tableresize",{requires:["tabletools"],init:function(i){i.on("contentDom",function(){var j;i.document.getBody().on("mousemove",function(k){k=k.data;if(j&&j.move(k.$.clientX)){b(k)}else{var o=k.getTarget(),n;if(o.is("table")||o.getAscendant("tbody",1)){n=o.getAscendant("table",1);if(!(o=n.getCustomData("_cke_table_pillars"))){n.setCustomData("_cke_table_pillars",o=a(n)),n.on("mouseout",e),n.on("mousedown",e)}i:{k=k.$.clientX;n=0;for(var l=o.length;n<l;n++){var m=o[n];if(k>=m.x&&k<=m.x+m.width){o=m;break i}}o=null}o&&(!j&&(j=new h(i)),j.attachTo(o))}}})})}})})();