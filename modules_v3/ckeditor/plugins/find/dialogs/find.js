(function(){function a(h){return h.type==CKEDITOR.NODE_TEXT&&0<h.getLength()&&(!f||!h.isReadOnly())}function d(h){return !(h.type==CKEDITOR.NODE_ELEMENT&&h.isBlockBoundary(CKEDITOR.tools.extend({},CKEDITOR.dtd.$empty,CKEDITOR.dtd.$nonEditable)))}var f,c=function(){return{textNode:this.textNode,offset:this.offset,character:this.textNode?this.textNode.getText().charAt(this.offset):null,hitMatchBoundary:this._.matchBoundary}},b=["find","replace"],e=[["txtFindFind","txtFindReplace"],["txtFindCaseChk","txtReplaceCaseChk"],["txtFindWordChk","txtReplaceWordChk"],["txtFindCyclic","txtReplaceCyclic"]],g=function(q,k){function i(p,m){var s=new CKEDITOR.dom.range;s.setStart(p.textNode,m?p.offset:p.offset+1);s.setEndAt(q.document.getBody(),CKEDITOR.POSITION_BEFORE_END);return s}function w(p){var m=q.getSelection(),s=q.document.getBody();m&&!p?(p=m.getRanges()[0].clone(),p.collapse(!0)):(p=new CKEDITOR.dom.range,p.setStartAt(s,CKEDITOR.POSITION_AFTER_START));p.setEndAt(s,CKEDITOR.POSITION_BEFORE_END);return p}var u=new CKEDITOR.style(CKEDITOR.tools.extend({attributes:{"data-cke-highlight":1},fullMatch:1,ignoreReadonly:1,childRule:function(){return 0}},q.config.find_highlight,!0)),j=function(p,m){var s=this,t=new CKEDITOR.dom.walker(p);t.guard=m?d:function(x){!d(x)&&(s._.matchBoundary=!0)};t.evaluator=a;t.breakOnFalse=1;p.startContainer.type==CKEDITOR.NODE_TEXT&&(this.textNode=p.startContainer,this.offset=p.startOffset-1);this._={matchWord:m,walker:t,matchBoundary:!1}};j.prototype={next:function(){return this.move()},back:function(){return this.move(!0)},move:function(p){var m=this.textNode;if(null===m){return c.call(this)}this._.matchBoundary=!1;if(m&&p&&0<this.offset){this.offset--}else{if(m&&this.offset<m.getLength()-1){this.offset++}else{for(m=null;!m&&!(m=this._.walker[p?"previous":"next"].call(this._.walker),this._.matchWord&&!m||this._.walker._.end);){}this.offset=(this.textNode=m)?p?m.getLength()-1:0:0}}return c.call(this)}};var v=function(p,m){this._={walker:p,cursors:[],rangeLength:m,highlightRange:null,isMatched:0}};v.prototype={toDomRange:function(){var p=new CKEDITOR.dom.range(q.document),m=this._.cursors;if(1>m.length){var s=this._.walker.textNode;if(s){p.setStartAfter(s)}else{return null}}else{s=m[0],m=m[m.length-1],p.setStart(s.textNode,s.offset),p.setEnd(m.textNode,m.offset+1)}return p},updateFromDomRange:function(p){var m=new j(p);this._.cursors=[];do{p=m.next(),p.character&&this._.cursors.push(p)}while(p.character);this._.rangeLength=this._.cursors.length},setMatched:function(){this._.isMatched=!0},clearMatched:function(){this._.isMatched=!1},isMatched:function(){return this._.isMatched},highlight:function(){if(!(1>this._.cursors.length)){this._.highlightRange&&this.removeHighlight();var p=this.toDomRange(),m=p.createBookmark();u.applyToRange(p);p.moveToBookmark(m);this._.highlightRange=p;m=p.startContainer;m.type!=CKEDITOR.NODE_ELEMENT&&(m=m.getParent());m.scrollIntoView();this.updateFromDomRange(p)}},removeHighlight:function(){if(this._.highlightRange){var m=this._.highlightRange.createBookmark();u.removeFromRange(this._.highlightRange);this._.highlightRange.moveToBookmark(m);this.updateFromDomRange(this._.highlightRange);this._.highlightRange=null}},isReadOnly:function(){return !this._.highlightRange?0:this._.highlightRange.startContainer.isReadOnly()},moveBack:function(){var p=this._.walker.back(),m=this._.cursors;p.hitMatchBoundary&&(this._.cursors=m=[]);m.unshift(p);m.length>this._.rangeLength&&m.pop();return p},moveNext:function(){var p=this._.walker.next(),m=this._.cursors;p.hitMatchBoundary&&(this._.cursors=m=[]);m.push(p);m.length>this._.rangeLength&&m.shift();return p},getEndCharacter:function(){var m=this._.cursors;return 1>m.length?null:m[m.length-1].character},getNextCharacterRange:function(p){var m,s;s=this._.cursors;s=(m=s[s.length-1])&&m.textNode?new j(i(m)):this._.walker;return new v(s,p)},getCursors:function(){return this._.cursors}};var r=function(p,m){var s=[-1];m&&(p=p.toLowerCase());for(var t=0;t<p.length;t++){for(s.push(s[t]+1);0<s[t+1]&&p.charAt(t)!=p.charAt(s[t+1]-1);){s[t+1]=s[s[t+1]-1]+1}}this._={overlap:s,state:0,ignoreCase:!!m,pattern:p}};r.prototype={feedCharacter:function(m){for(this._.ignoreCase&&(m=m.toLowerCase());;){if(m==this._.pattern.charAt(this._.state)){return this._.state++,this._.state==this._.pattern.length?(this._.state=0,2):1}if(this._.state){this._.state=this._.overlap[this._.state]}else{return 0}}return null},reset:function(){this._.state=0}};var h=/[.,"'?!;: \u0085\u00a0\u1680\u280e\u2028\u2029\u202f\u205f\u3000]/,o=function(p){if(!p){return !0}var m=p.charCodeAt(0);return 9<=m&&13>=m||8192<=m&&8202>=m||h.test(p)},n={searchRange:null,matchRange:null,find:function(F,E,D,A,B,m){this.matchRange?(this.matchRange.removeHighlight(),this.matchRange=this.matchRange.getNextCharacterRange(F.length)):this.matchRange=new v(new j(this.searchRange),F.length);for(var x=new r(F,!E),t=0,s="%";null!==s;){for(this.matchRange.moveNext();s=this.matchRange.getEndCharacter();){t=x.feedCharacter(s);if(2==t){break}this.matchRange.moveNext().hitMatchBoundary&&x.reset()}if(2==t){if(D){var y=this.matchRange.getCursors(),p=y[y.length-1],y=y[0],z=new CKEDITOR.dom.range;z.setStartAt(q.document.getBody(),CKEDITOR.POSITION_AFTER_START);z.setEnd(y.textNode,y.offset);y=z;p=i(p);y.trim();p.trim();y=new j(y,!0);p=new j(p,!0);if(!o(y.back().character)||!o(p.next().character)){continue}}this.matchRange.setMatched();!1!==B&&this.matchRange.highlight();return !0}}this.matchRange.clearMatched();this.matchRange.removeHighlight();return A&&!m?(this.searchRange=w(1),this.matchRange=null,arguments.callee.apply(this,Array.prototype.slice.call(arguments).concat([!0]))):!1},replaceCounter:0,replace:function(p,m,A,y,z,x,t){f=1;p=0;if(this.matchRange&&this.matchRange.isMatched()&&!this.matchRange._.isReplaced&&!this.matchRange.isReadOnly()){this.matchRange.removeHighlight();m=this.matchRange.toDomRange();A=q.document.createText(A);if(!t){var s=q.getSelection();s.selectRanges([m]);q.fire("saveSnapshot")}m.deleteContents();m.insertNode(A);t||(s.selectRanges([m]),q.fire("saveSnapshot"));this.matchRange.updateFromDomRange(m);t||this.matchRange.highlight();this.matchRange._.isReplaced=!0;this.replaceCounter++;p=1}else{p=this.find(m,y,z,x,!t)}f=0;return p}},l=q.lang.findAndReplace;return{title:l.title,resizable:CKEDITOR.DIALOG_RESIZE_NONE,minWidth:350,minHeight:170,buttons:[CKEDITOR.dialog.cancelButton],contents:[{id:"find",label:l.find,title:l.find,accessKey:"",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindFind",label:l.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",id:"btnFind",align:"left",style:"width:100%",label:l.find,onClick:function(){var m=this.getDialog();n.find(m.getValueOf("find","txtFindFind"),m.getValueOf("find","txtFindCaseChk"),m.getValueOf("find","txtFindWordChk"),m.getValueOf("find","txtFindCyclic"))||alert(l.notFoundMsg)}}]},{type:"fieldset",label:CKEDITOR.tools.htmlEncode(l.findOptions),style:"margin-top:29px",children:[{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtFindCaseChk",isChanged:!1,label:l.matchCase},{type:"checkbox",id:"txtFindWordChk",isChanged:!1,label:l.matchWord},{type:"checkbox",id:"txtFindCyclic",isChanged:!1,"default":!0,label:l.matchCyclic}]}]}]},{id:"replace",label:l.replace,accessKey:"M",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindReplace",label:l.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",id:"btnFindReplace",align:"left",style:"width:100%",label:l.replace,onClick:function(){var m=this.getDialog();n.replace(m,m.getValueOf("replace","txtFindReplace"),m.getValueOf("replace","txtReplace"),m.getValueOf("replace","txtReplaceCaseChk"),m.getValueOf("replace","txtReplaceWordChk"),m.getValueOf("replace","txtReplaceCyclic"))||alert(l.notFoundMsg)}}]},{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtReplace",label:l.replaceWith,isChanged:!1,labelLayout:"horizontal",accessKey:"R"},{type:"button",id:"btnReplaceAll",align:"left",style:"width:100%",label:l.replaceAll,isChanged:!1,onClick:function(){var m=this.getDialog();n.replaceCounter=0;n.searchRange=w(1);n.matchRange&&(n.matchRange.removeHighlight(),n.matchRange=null);for(q.fire("saveSnapshot");n.replace(m,m.getValueOf("replace","txtFindReplace"),m.getValueOf("replace","txtReplace"),m.getValueOf("replace","txtReplaceCaseChk"),m.getValueOf("replace","txtReplaceWordChk"),!1,!0);){}n.replaceCounter?(alert(l.replaceSuccessMsg.replace(/%1/,n.replaceCounter)),q.fire("saveSnapshot")):alert(l.notFoundMsg)}}]},{type:"fieldset",label:CKEDITOR.tools.htmlEncode(l.findOptions),children:[{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtReplaceCaseChk",isChanged:!1,label:l.matchCase},{type:"checkbox",id:"txtReplaceWordChk",isChanged:!1,label:l.matchWord},{type:"checkbox",id:"txtReplaceCyclic",isChanged:!1,"default":!0,label:l.matchCyclic}]}]}]}],onLoad:function(){var p=this,m,s=0;this.on("hide",function(){s=0});this.on("show",function(){s=1});this.selectPage=CKEDITOR.tools.override(this.selectPage,function(t){return function(C){t.call(p,C);var B=p._.tabs[C],z;z="find"===C?"txtFindWordChk":"txtReplaceWordChk";m=p.getContentElement(C,"find"===C?"txtFindFind":"txtFindReplace");p.getContentElement(C,z);B.initialized||(CKEDITOR.document.getById(m._.inputId),B.initialized=!0);if(s){var y;C="find"===C?1:0;var B=1-C,x,A=e.length;for(x=0;x<A;x++){z=this.getContentElement(b[C],e[x][C]),y=this.getContentElement(b[B],e[x][B]),y.setValue(z.getValue())}}}})},onShow:function(){n.searchRange=w();var p=this.getParentEditor().getSelection().getSelectedText(),m=this.getContentElement(k,"find"==k?"txtFindFind":"txtFindReplace");m.setValue(p);m.select();this.selectPage(k);this[("find"==k&&this._.editor.readOnly?"hide":"show")+"Page"]("replace")},onHide:function(){var m;n.matchRange&&n.matchRange.isMatched()&&(n.matchRange.removeHighlight(),q.focus(),(m=n.matchRange.toDomRange())&&q.getSelection().selectRanges([m]));delete n.matchRange},onFocus:function(){return"replace"==k?this.getContentElement("replace","txtFindReplace"):this.getContentElement("find","txtFindFind")}}};CKEDITOR.dialog.add("find",function(h){return g(h,"find")});CKEDITOR.dialog.add("replace",function(h){return g(h,"replace")})})();